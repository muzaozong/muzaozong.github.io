<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><title>双十一压测&amp;Java应用性能问题排查总结 | 木枣粽子 | BLOG</title><meta name="description" content="双十一压测&amp;Java应用性能问题排查总结"><meta name="keywords" content="Java,性能"><meta name="author" content="木枣粽子"><meta name="copyright" content="木枣粽子"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="双十一压测&amp;Java应用性能问题排查总结"><meta name="twitter:description" content="双十一压测&amp;Java应用性能问题排查总结"><meta name="twitter:image" content="https://uploadbeta.com/api/pictures/random/?key=BingEverydayWallpaperPicture"><meta property="og:type" content="article"><meta property="og:title" content="双十一压测&amp;Java应用性能问题排查总结"><meta property="og:url" content="https://www.cayun.me/java/%E5%8F%8C%E5%8D%81%E4%B8%80%E5%8E%8B%E6%B5%8B&amp;Java%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%80%BB%E7%BB%93/"><meta property="og:site_name" content="木枣粽子 | BLOG"><meta property="og:description" content="双十一压测&amp;Java应用性能问题排查总结"><meta property="og:image" content="https://uploadbeta.com/api/pictures/random/?key=BingEverydayWallpaperPicture"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="https://www.cayun.me/java/%E5%8F%8C%E5%8D%81%E4%B8%80%E5%8E%8B%E6%B5%8B&amp;Java%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%80%BB%E7%BB%93/"><link rel="next" title="JVM常量池&amp;字符串存储" href="/https:/www.cayun.me/java/JVM%E5%B8%B8%E9%87%8F%E6%B1%A0&amp;%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AD%98%E5%82%A8/"><link rel="dns-prefetch" href="https://www.google-analytics.com"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-93052608-1', 'auto');
ga('send', 'pageview');
</script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight_copy: 'false',
  highlight_lang: 'true',
  highlight_shrink: 'false',
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: '按',
    message_next: '键将本页加入书签'
  },
  runtime_unit: '天',
  copyright: undefined,
  copy_copyright_js: false,
  ClickShowText: undefined,
  medium_zoom: 'false',
  Snackbar: undefined
  
}</script></head><body><div id="header"> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">木枣粽子 | BLOG</a></span><i class="fa fa-bars fa-fw toggle-menu pull_right close" aria-hidden="true"></i><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> HOME</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></span><span class="pull_right" id="search_button"></span></div></div><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="lazyload avatar_img" src="/img/head.jpg" onerror="onerror=null;src='/img/friend_404.gif'"></div><div class="mobile_post_data"><div class="mobile_data_item is_center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">文章</div><div class="length_num">195</div></a></div></div><div class="mobile_data_item is_center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">标签</div><div class="length_num">145</div></a></div></div><div class="mobile_data_item is_center">     <div class="mobile_data_link"><a href="/categories/"><div class="headline">分类</div><div class="length_num">22</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> HOME</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">目录</div><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#一、为什么要压测"><span class="toc_mobile_items-text">一、为什么要压测</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#二、如何压测"><span class="toc_mobile_items-text">二、如何压测</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#关注哪些指标"><span class="toc_mobile_items-text">关注哪些指标</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#压测工具"><span class="toc_mobile_items-text">压测工具</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#1-ab"><span class="toc_mobile_items-text">1. ab</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-jmeter"><span class="toc_mobile_items-text">2. jmeter</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#图形化方式"><span class="toc_mobile_items-text">图形化方式</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#命令行方式"><span class="toc_mobile_items-text">命令行方式</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#3-ab与jmeter的对比"><span class="toc_mobile_items-text">3.  ab与jmeter的对比</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#三、如何制定大促压测目标"><span class="toc_mobile_items-text">三、如何制定大促压测目标</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#压测接口的选取"><span class="toc_mobile_items-text">压测接口的选取</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#压测并发数的设定"><span class="toc_mobile_items-text">压测并发数的设定</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#TPS的设定"><span class="toc_mobile_items-text">TPS的设定</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#四、关注哪些指标"><span class="toc_mobile_items-text">四、关注哪些指标</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#五、如何去排查问题"><span class="toc_mobile_items-text">五、如何去排查问题</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#为什么要找瓶颈点"><span class="toc_mobile_items-text">为什么要找瓶颈点</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#几个问题（请根据自己的实际认知回答）"><span class="toc_mobile_items-text">几个问题（请根据自己的实际认知回答）</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#如何排查性能问题"><span class="toc_mobile_items-text">如何排查性能问题</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#1-数据库慢SQL问题"><span class="toc_mobile_items-text">1. 数据库慢SQL问题</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-网络带宽过大"><span class="toc_mobile_items-text">2. 网络带宽过大</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#如何排查网络带宽过大的问题"><span class="toc_mobile_items-text">如何排查网络带宽过大的问题</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#3-数据库CPU过高"><span class="toc_mobile_items-text">3.  数据库CPU过高</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#4-应用服务器磁盘IO问题"><span class="toc_mobile_items-text">4. 应用服务器磁盘IO问题</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#5-GC问题"><span class="toc_mobile_items-text">5. GC问题</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#如何监测FullGC"><span class="toc_mobile_items-text">如何监测FullGC</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#如何排查GC问题"><span class="toc_mobile_items-text">如何排查GC问题</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#举个例子"><span class="toc_mobile_items-text">举个例子</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#6-应用服务器cpu达到100-问题-以下只针对常规业务应用，不考虑追求极端性能应用"><span class="toc_mobile_items-text">6. 应用服务器cpu达到100%问题(以下只针对常规业务应用，不考虑追求极端性能应用)</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#排查cpu问题的方式"><span class="toc_mobile_items-text">排查cpu问题的方式</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-5"><a class="toc_mobile_items-link" href="#其他一些方式"><span class="toc_mobile_items-text">其他一些方式</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#7-线程阻塞问题"><span class="toc_mobile_items-text">7. 线程阻塞问题</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#jstack的方式查看"><span class="toc_mobile_items-text">jstack的方式查看</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#arthas的方式查看"><span class="toc_mobile_items-text">arthas的方式查看</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#8-内存泄漏问题"><span class="toc_mobile_items-text">8. 内存泄漏问题</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#Heap内存泄漏"><span class="toc_mobile_items-text">Heap内存泄漏</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#metaspace内存泄漏"><span class="toc_mobile_items-text">metaspace内存泄漏</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#nonheap内存泄漏"><span class="toc_mobile_items-text">nonheap内存泄漏</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#9-从业务角度去排查问题"><span class="toc_mobile_items-text">9. 从业务角度去排查问题</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#10-总结"><span class="toc_mobile_items-text">10. 总结</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-1"><a class="toc_mobile_items-link" href="#六、压测中出现的典型性能问题"><span class="toc_mobile_items-text">六、压测中出现的典型性能问题</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#1-Log4j日志阻塞问题"><span class="toc_mobile_items-text">1. Log4j日志阻塞问题</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#2-redis大value问题"><span class="toc_mobile_items-text">2. redis大value问题</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#3-sql全字段查询问题"><span class="toc_mobile_items-text">3. sql全字段查询问题</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#4-sql未加索引问题"><span class="toc_mobile_items-text">4. sql未加索引问题</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#5-sql-N-1问题"><span class="toc_mobile_items-text">5. sql N+1问题</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#6-正则表达式问题"><span class="toc_mobile_items-text">6. 正则表达式问题</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#7-DateFormat问题"><span class="toc_mobile_items-text">7. DateFormat问题</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#8-线程池不正确使用问题"><span class="toc_mobile_items-text">8. 线程池不正确使用问题</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#9-传说中的问题"><span class="toc_mobile_items-text">9. 传说中的问题</span></a></li></ol></li></ol></li></ol></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#一、为什么要压测"><span class="toc-text">一、为什么要压测</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#二、如何压测"><span class="toc-text">二、如何压测</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#关注哪些指标"><span class="toc-text">关注哪些指标</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#压测工具"><span class="toc-text">压测工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-ab"><span class="toc-text">1. ab</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-jmeter"><span class="toc-text">2. jmeter</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#图形化方式"><span class="toc-text">图形化方式</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#命令行方式"><span class="toc-text">命令行方式</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-ab与jmeter的对比"><span class="toc-text">3.  ab与jmeter的对比</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#三、如何制定大促压测目标"><span class="toc-text">三、如何制定大促压测目标</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#压测接口的选取"><span class="toc-text">压测接口的选取</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#压测并发数的设定"><span class="toc-text">压测并发数的设定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TPS的设定"><span class="toc-text">TPS的设定</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#四、关注哪些指标"><span class="toc-text">四、关注哪些指标</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#五、如何去排查问题"><span class="toc-text">五、如何去排查问题</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#为什么要找瓶颈点"><span class="toc-text">为什么要找瓶颈点</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#几个问题（请根据自己的实际认知回答）"><span class="toc-text">几个问题（请根据自己的实际认知回答）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#如何排查性能问题"><span class="toc-text">如何排查性能问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-数据库慢SQL问题"><span class="toc-text">1. 数据库慢SQL问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-网络带宽过大"><span class="toc-text">2. 网络带宽过大</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#如何排查网络带宽过大的问题"><span class="toc-text">如何排查网络带宽过大的问题</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-数据库CPU过高"><span class="toc-text">3.  数据库CPU过高</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-应用服务器磁盘IO问题"><span class="toc-text">4. 应用服务器磁盘IO问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-GC问题"><span class="toc-text">5. GC问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#如何监测FullGC"><span class="toc-text">如何监测FullGC</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#如何排查GC问题"><span class="toc-text">如何排查GC问题</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#举个例子"><span class="toc-text">举个例子</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-应用服务器cpu达到100-问题-以下只针对常规业务应用，不考虑追求极端性能应用"><span class="toc-text">6. 应用服务器cpu达到100%问题(以下只针对常规业务应用，不考虑追求极端性能应用)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#排查cpu问题的方式"><span class="toc-text">排查cpu问题的方式</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#其他一些方式"><span class="toc-text">其他一些方式</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-线程阻塞问题"><span class="toc-text">7. 线程阻塞问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#jstack的方式查看"><span class="toc-text">jstack的方式查看</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#arthas的方式查看"><span class="toc-text">arthas的方式查看</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-内存泄漏问题"><span class="toc-text">8. 内存泄漏问题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Heap内存泄漏"><span class="toc-text">Heap内存泄漏</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#metaspace内存泄漏"><span class="toc-text">metaspace内存泄漏</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#nonheap内存泄漏"><span class="toc-text">nonheap内存泄漏</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-从业务角度去排查问题"><span class="toc-text">9. 从业务角度去排查问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10-总结"><span class="toc-text">10. 总结</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#六、压测中出现的典型性能问题"><span class="toc-text">六、压测中出现的典型性能问题</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-Log4j日志阻塞问题"><span class="toc-text">1. Log4j日志阻塞问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-redis大value问题"><span class="toc-text">2. redis大value问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-sql全字段查询问题"><span class="toc-text">3. sql全字段查询问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-sql未加索引问题"><span class="toc-text">4. sql未加索引问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-sql-N-1问题"><span class="toc-text">5. sql N+1问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-正则表达式问题"><span class="toc-text">6. 正则表达式问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7-DateFormat问题"><span class="toc-text">7. DateFormat问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8-线程池不正确使用问题"><span class="toc-text">8. 线程池不正确使用问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9-传说中的问题"><span class="toc-text">9. 传说中的问题</span></a></li></ol></li></ol></li></ol></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(https://uploadbeta.com/api/pictures/random/?key=BingEverydayWallpaperPicture)"><div id="post-info"><div id="post-title"><div class="posttitle">双十一压测&amp;Java应用性能问题排查总结</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 发表于 2019-11-07<span class="post-meta__separator">|</span><i class="fa fa-history" aria-hidden="true"></i> 更新于 2019-12-02</time><span class="post-meta__separator mobile_hidden">|</span><span class="mobile_hidden"><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Java/">Java</a></span><div class="post-meta-wordcount"><i class="fa fa-eye post-meta__icon" aria-hidden="true">       </i><span>阅读量: </span><span id="busuanzi_value_page_pv"></span></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><p>连续参加了两年公司的双十一大促压测项目，遇到了很多问题，也成长了很多，于是在这里对大促压测做一份总结。以及记录一下大促压测过程中出现的一些常见的Java应用性能问题。</p>
<a id="more"></a>

<h1 id="一、为什么要压测"><a href="#一、为什么要压测" class="headerlink" title="一、为什么要压测"></a>一、为什么要压测</h1><ol>
<li>找出应用的性能瓶颈</li>
<li>探究应用的性能基准</li>
<li>给大促机器扩容提供参考依据</li>
</ol>
<h1 id="二、如何压测"><a href="#二、如何压测" class="headerlink" title="二、如何压测"></a>二、如何压测</h1><h2 id="关注哪些指标"><a href="#关注哪些指标" class="headerlink" title="关注哪些指标"></a>关注哪些指标</h2><p>吞吐率 TPS（每秒响应的请求数量）</p>
<p>响应时长 RT （一般情况下重点关注90%请求的响应时长，我们的大促标准一般是1s以内）</p>
<p>错误率   （看业务的可接受程度，我们的大促标准是不超过2%）</p>
<h2 id="压测工具"><a href="#压测工具" class="headerlink" title="压测工具"></a>压测工具</h2><p>现在有很多可以用来进行压测的工具，例如ab、jmeter、wrk等，此处主要介绍一下ab和jmeter。</p>
<h3 id="1-ab"><a href="#1-ab" class="headerlink" title="1. ab"></a>1. ab</h3><p>ab是一个命令行工具，使用起来非常简单，</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="comment"># -c表示并发数，-n表示请求总数，其他一些参数可以查询手册/相关资料</span></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line">ab -c 10 -n 200 https://www.baidu.com/</span></pre></td></tr></table></figure>

<p>命令执行完成后会得出一份压测结果报告，其中错误请求数、TPS和RT在下图中有标注</p>
<p><img alt="image-20191105160037216" data-src="https://img.cayun.me/2019-11-05-080037.png" class="lazyload"></p>
<h3 id="2-jmeter"><a href="#2-jmeter" class="headerlink" title="2. jmeter"></a>2. jmeter</h3><p>jmeter同时支持图形化界面和命令行方式，</p>
<h4 id="图形化方式"><a href="#图形化方式" class="headerlink" title="图形化方式"></a>图形化方式</h4><p>首先在”Test Plan”中添加一个”线程组”，里面可以设置并发数、压测时长等参数。</p>
<p>接下来需要在“线程组”中添加“HTTP请求取样器”，里面是设置HTTP请求的各项参数。</p>
<p>最后添加查看结果用的监听组件，我个人比较常用的有“查看结果树”、“聚合报告”和“TPS曲线图”（需要安装）。</p>
<p><img alt="image-20191105163923823" data-src="https://img.cayun.me/2019-11-05-083924.png" class="lazyload"></p>
<p>重点来看一下“聚合报告”，（一定要记得每次压测前都要清理一下数据才行[上方的”齿轮+2个扫把”图标]，不然回合之前的数据混合在一起）</p>
<p><img alt="image-20191105165259837" data-src="https://img.cayun.me/2019-11-05-085300.png" class="lazyload"></p>
<p>上面只是一些简单的介绍，事实上jmeter还支持很多复杂的压测场景: jdbc压测、dubbo压测、动态参数压测、自定义响应断言……这些可以自行网上搜索。</p>
<h4 id="命令行方式"><a href="#命令行方式" class="headerlink" title="命令行方式"></a>命令行方式</h4><p>命令行方式主要可以用来做一些自动化压测的任务。使用方式如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">jmeter -n -t [jmx脚本] -l [压测请求结果文件] -e -o [压测报告文件夹(会生成一堆网页文件)]</span></pre></td></tr></table></figure>

<p>其中jmx脚本可以先通过jmeter图形化界面全部设置好了，然后保存一下就会生成对应的jmx脚本了。</p>
<h3 id="3-ab与jmeter的对比"><a href="#3-ab与jmeter的对比" class="headerlink" title="3.  ab与jmeter的对比"></a>3.  ab与jmeter的对比</h3><table>
<thead>
<tr>
<th>操作</th>
<th>ab</th>
<th>jmeter</th>
</tr>
</thead>
<tbody><tr>
<td>操作难度</td>
<td>简单</td>
<td>复杂</td>
</tr>
<tr>
<td>命令行</td>
<td>支持，操作简单</td>
<td>支持，操作稍微复杂一些</td>
</tr>
<tr>
<td>请求结果列表</td>
<td>无法显示</td>
<td>有详细请求列表</td>
</tr>
<tr>
<td>动态参数</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>复杂场景支持</td>
<td>极其有限</td>
<td>丰富</td>
</tr>
</tbody></table>
<p>基本上，对于一些简单的固定参数请求并且是自测的情况下，使用ab会非常简便。一般情况下jmeter的适用性会更广。</p>
<h1 id="三、如何制定大促压测目标"><a href="#三、如何制定大促压测目标" class="headerlink" title="三、如何制定大促压测目标"></a>三、如何制定大促压测目标</h1><h2 id="压测接口的选取"><a href="#压测接口的选取" class="headerlink" title="压测接口的选取"></a>压测接口的选取</h2><p>一般情况下，不必要将公司所有的接口都进行压测，压测接口主要包含核心链路接口、访问量大的接口以及新上线的活动接口。获取方式基本是如下两种:</p>
<ol>
<li>对核心业务进行抓包</li>
<li>咨询各业务线负责人</li>
</ol>
<h2 id="压测并发数的设定"><a href="#压测并发数的设定" class="headerlink" title="压测并发数的设定"></a>压测并发数的设定</h2><p>在上面的两种压测工具中，我们都看到了一个参数为并发数，这个参数一般需要根据公司的业务量来进行推算，可以去网上找些资料。不过为了简化压测过程，我们公司的大促统一使用读接口200并发，写接口100并发的标准来执行的。</p>
<p>事实上，我对并发数的设定这块也比较模糊，因此上述描述仅做参考。</p>
<h2 id="TPS的设定"><a href="#TPS的设定" class="headerlink" title="TPS的设定"></a>TPS的设定</h2><p>一般是根据大促销售目标、平时各接口qps、各接口访问量按照比例制定出最终的TPS目标，不要忘了最后乘上一个风险系数。具体的算法可以自行设计，大概思路就是这样的。</p>
<h1 id="四、关注哪些指标"><a href="#四、关注哪些指标" class="headerlink" title="四、关注哪些指标"></a>四、关注哪些指标</h1><p>对于压测工具的指标上面已经说过了，主要是关注TPS、RT和错误率。</p>
<p>那么还有哪些需要关注的指标呢？其实这个都是根据公司的业务来决定的，例如我们公司主要使用java应用、mysql作为数据库、redis作为缓存中间件，那么我们主要关注的性能数据如下:</p>
<table>
<thead>
<tr>
<th>监控对象</th>
<th>性能指标</th>
</tr>
</thead>
<tbody><tr>
<td>压测指标</td>
<td>TPS、RT、错误率</td>
</tr>
<tr>
<td>应用服务器（服务化应用包含下游链路的应用服务器）</td>
<td>CPU、网络带宽、磁盘IO、GC</td>
</tr>
<tr>
<td>数据库</td>
<td>CPU、网络带宽、慢SQL</td>
</tr>
<tr>
<td>REDIS</td>
<td>网络带宽</td>
</tr>
<tr>
<td>其他</td>
<td>(根据相应特性自行设定)</td>
</tr>
</tbody></table>
<p>每个监控对象都有其特性，所以应该根据实际情况的来制定自己的监控指标。</p>
<h1 id="五、如何去排查问题"><a href="#五、如何去排查问题" class="headerlink" title="五、如何去排查问题"></a>五、如何去排查问题</h1><p>由于公司主要使用的是Java8，因此本文也主要是针对Java8应用做分析。</p>
<h2 id="为什么要找瓶颈点"><a href="#为什么要找瓶颈点" class="headerlink" title="为什么要找瓶颈点"></a>为什么要找瓶颈点</h2><p>举个例子，如果告诉你一个接口稍微一些压力就能把服务器的cpu跑满了，导致TPS上不去，里面一堆复杂逻辑，而且还有不少远程调用(数据库查询、缓存查询、dubbo调用等)。</p>
<p>你可能对业务非常熟悉，开始大刀阔斧地进行代码修改、增加缓存、业务降级等，也许期望很美好，但是事实上有极大的可能是你做的一切对TPS只能产生轻微的影响。然后只能通过不停地尝试删改代码去查找问题点，那么显然只能带来几个结果: 1.效率低下 2.把代码弄的一团糟 3.不具备可复制性 4.对业务会造成或小或大的影响，最最关键的是改的时候心里也没底、改完之后心里依旧没底。</p>
<h2 id="几个问题（请根据自己的实际认知回答）"><a href="#几个问题（请根据自己的实际认知回答）" class="headerlink" title="几个问题（请根据自己的实际认知回答）"></a>几个问题（请根据自己的实际认知回答）</h2><ol>
<li>你认为cpu达到100%是好是坏？</li>
<li>你认为哪些代码对cpu的开销大？你认为大量判断逻辑对cpu的开销大吗？</li>
<li>你认为大量的网络数据传输对哪些指标的影响大？</li>
<li>你认为对于Java应用监控服务器内存的必要性有多高？</li>
</ol>
<h2 id="如何排查性能问题"><a href="#如何排查性能问题" class="headerlink" title="如何排查性能问题"></a>如何排查性能问题</h2><p>那么问题来了，我们到底应该怎么去排查问题呢？（以下均为一些个人经验，可能会有不少遗漏，或者会有一些错误，如果有的话，请及时指出）</p>
<p>排查问题的话，首先我们需要先有一些排查的突破点和方向。（无法保证100%找到对应问题，但是大幅提升找到性能问题的效率）</p>
<p>前面有提到，我们压测过程中需要监控各项指标，那么其实我们的突破方向一般就在这些监控指标上了。我们可以对这些指标进行分类，对于每一类都可以有着相对应的排查策略。</p>
<h3 id="1-数据库慢SQL问题"><a href="#1-数据库慢SQL问题" class="headerlink" title="1. 数据库慢SQL问题"></a>1. 数据库慢SQL问题</h3><p>这个问题是最好排查的一类问题了，只需要对慢SQL进行针对性地分析优化即可，此处不过多讲解。</p>
<h3 id="2-网络带宽过大"><a href="#2-网络带宽过大" class="headerlink" title="2. 网络带宽过大"></a>2. 网络带宽过大</h3><p>那么一个问题来了，此处的网络带宽到底是指的什么呢？换个问法吧，假设数据库的带宽上限为1Gbps，实际上压测导致数据库的网络带宽占用了800Mbps，那可以说明这个接口是一个问题接口吗？</p>
<p>考虑下面这种情况，这个接口的TPS假设在压测过程中达到了80000，远大于接口实际目标TPS，那该接口将数据库的带宽占到800Mbps是合情合理的。</p>
<p>那么上面的问题的答案也就呼之欲出了，这里的网络带宽，在很多情况下，我们更应该关注的是单个请求的平均占用带宽。</p>
<h4 id="如何排查网络带宽过大的问题"><a href="#如何排查网络带宽过大的问题" class="headerlink" title="如何排查网络带宽过大的问题"></a>如何排查网络带宽过大的问题</h4><p>猜一猜，其实不难想象，就是抓包。我常用的抓包方式是通过tcpdump抓包，然后使用wireshark解析抓包内容（如果有更简单的方式，可以留言）。下面讲一下tcpdump+wireshark的方式如何抓包。</p>
<p>为了避免大量的数据混杂在一起，一般情况下，我更喜欢是抓单个请求的数据，而不是在压测中抓包。下面简单介绍一下tcpdump和wireshark如何抓包，</p>
<ol>
<li>在服务器上执行命令<code>sudo tcpdump -w xxx.pcap</code></li>
<li>然后请求一下接口</li>
<li>Ctrl+C停掉tcpdump</li>
<li>将xxx.pcap拷到本地，使用wireshark打开</li>
<li>如下图，找到一个请求 &gt; 右键”Follow” &gt; “TCP Stream”</li>
</ol>
<p><img alt="image-20191106175128011" data-src="https://img.cayun.me/2019-11-06-095128.png" class="lazyload"></p>
<p>打开TCP流后通过调整右下方的”Stream”，我们就可以看到应用在请求过程中的网络数据(包含Http请求数据、Mysql请求数据、Redis请求数据……)，以下图为例，可以看到这个请求的mysql请求量非常大，接下来就是查看到底是哪些SQL语句导致的。</p>
<p><img alt="image-20191106175708652" data-src="https://img.cayun.me/2019-11-06-095709.png" class="lazyload"></p>
<h3 id="3-数据库CPU过高"><a href="#3-数据库CPU过高" class="headerlink" title="3.  数据库CPU过高"></a>3.  数据库CPU过高</h3><p>开启数据库日志，看看压测期间都执行了哪些SQL语句，然后进行针对性的分析即可。一般情况下，全表扫描、不加索引、大表的count这些都比较容易引起cpu问题。绝大多数情况下都可以通过技术手段来优化，但也有可能技术手段无法优化的情况，则可以考虑业务上的优化。</p>
<h3 id="4-应用服务器磁盘IO问题"><a href="#4-应用服务器磁盘IO问题" class="headerlink" title="4. 应用服务器磁盘IO问题"></a>4. 应用服务器磁盘IO问题</h3><p>绝大多数情况下是由于日志问题导致的，日志问题一般分为如下两种情况:</p>
<ol>
<li>压测接口参数/环境有问题，导致接口不停地打印异常</li>
<li>打印了大量的业务日志</li>
</ol>
<p>至于其他的磁盘IO问题，则需要根据实际业务去分析了，暂时未遇到过，此处略过。</p>
<h3 id="5-GC问题"><a href="#5-GC问题" class="headerlink" title="5. GC问题"></a>5. GC问题</h3><p>一般情况下，我们不太需要去关注YoungGC，更多地只需要关注FullGC就行了，如果只是偶尔出现一次FullGC，那基本上没有太大问题，如果频繁FullGC(几秒就有一次FullGC，甚至可能一秒几次)，那就要做相应排查了。</p>
<h4 id="如何监测FullGC"><a href="#如何监测FullGC" class="headerlink" title="如何监测FullGC"></a>如何监测FullGC</h4><p>一般可以通过jstat来监测，命令如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">jstat -gccause [PID] 1000</span></pre></td></tr></table></figure>

<p><img alt="image-20191106141050865" data-src="https://img.cayun.me/2019-11-06-061051.png" class="lazyload"></p>
<p>具体的每个参数的含义可以查看<code>man jstat</code>手册。</p>
<p>其实用visualvm装个GC插件然后监测java进程，可以很直观地看到java应用的内存和GC情况，就是操作相对而言比较繁琐。</p>
<h4 id="如何排查GC问题"><a href="#如何排查GC问题" class="headerlink" title="如何排查GC问题"></a>如何排查GC问题</h4><p>很多情况下(主要是大对象/大量堆对象导致FullGC的情况)，都可以通过将Java堆dump下来，然后通过MAT、jhat等内存分析工具来分析。流程如下:</p>
<ol>
<li>首先需要dump堆文件，在服务器上执行如下命令: <code>jmap -dump:format=b,file=heap.bin [PID]</code></li>
<li>然后将堆文件拷到本地，使用MAT打开(需要调大内存启动参数，必须要比堆文件大)，个人比较常用的MAT功能是”Leak Suspects”和”Histogram”，前者是可能出现内存泄漏的怀疑点，后者是堆中类的直方图</li>
</ol>
<h5 id="举个例子"><a href="#举个例子" class="headerlink" title="举个例子"></a>举个例子</h5><p>此处以一个真实的出现过宕机的Java应用的堆作为举例(加上-XX:+HeapDumpOnOutOfMemoryError这个参数就可以在出现OOM的时候自动将堆dump下来了)</p>
<p><img alt="image-20191106144338830" data-src="https://img.cayun.me/2019-11-06-064339.png" class="lazyload"></p>
<p>本文简单看一下”Leak Suspects”，至于Histogram则可以自行去研究。</p>
<p><img alt="image-20191106145139680" data-src="https://img.cayun.me/2019-11-06-065139.png" class="lazyload"></p>
<p>这个堆文件其实还是比较简单的，因为可怀疑点只有一个，八九不离十就是这块出现问题了。点击”Details”可以看到更详细的信息(ps:不是每种怀疑对象都有Details的)。</p>
<p><img alt="image-20191106145600510" data-src="https://img.cayun.me/2019-11-06-065600.png" class="lazyload"></p>
<p>在详细信息里面基本上可以很明显地看出来，有一个SQL语句查出来了超多的数据，导致内存塞不下了。事实上，最终在数据库日志中找到了这条语句，共查询了200W+条数据。</p>
<p>这个例子比较简单，事实上我们可能会遇到更多复杂的情况，例如怀疑对象特别多，甚至真正原因并不在怀疑对象中，或者metaspace导致的FullGC，这些情况下，我们可能又需要采用其他方式去处理这些问题。</p>
<h3 id="6-应用服务器cpu达到100-问题-以下只针对常规业务应用，不考虑追求极端性能应用"><a href="#6-应用服务器cpu达到100-问题-以下只针对常规业务应用，不考虑追求极端性能应用" class="headerlink" title="6. 应用服务器cpu达到100%问题(以下只针对常规业务应用，不考虑追求极端性能应用)"></a>6. 应用服务器cpu达到100%问题(以下只针对常规业务应用，不考虑追求极端性能应用)</h3><p>还记得之前的有个问题——你认为cpu达到100%是好是坏吗？</p>
<p>那么在这里我揭晓一下答案，如果接口的TPS高，那么我们的服务器的cpu当然是越高越好了，因为这说明了资源被充分利用了。但是，如果接口的TPS低，那么cpu达到100%就说明很有可能是有问题了，很大可能是存在问题代码占据了大量的cpu。</p>
<p>那么还有一个问题就是，你认为哪些代码对cpu的开销大？</p>
<ol>
<li>大量的业务逻辑判断——几乎无影响 (上万个if语句可能总的执行时间都不会超过1ms)</li>
<li>大量的网络传输——几乎无影响 (会有一些cpu开销，但是极其有限，可以找个应用生成火焰图看看)</li>
<li>线程阻塞——几乎无影响 (如果不考虑极其大量的线程切换的话，那么线程阻塞是不会占用cpu的)</li>
<li>大量的内存拷贝——几乎无影响 (会有一些cpu开销，但是极其有限，可以找个应用生成火焰图看看)</li>
</ol>
<p>这些都没有影响，那到底什么才对cpu有影响呢？常见的业务场景总结如下(如有遗漏请留言补充)</p>
<ol>
<li>长度特别大的循环，尤其是多层嵌套循环</li>
<li>字符串处理，常见的消耗cpu的操作是json解析、正则表达式</li>
<li>日期格式化，Date.format非常消耗cpu</li>
<li>大量的sql数据处理，sql数据处理量很多的情况下是会大量占用cpu的，这个情况最为常见</li>
<li>大量的日志输出有时也会占用不少的cpu，不过更多的情况是产生线程阻塞</li>
</ol>
<h4 id="排查cpu问题的方式"><a href="#排查cpu问题的方式" class="headerlink" title="排查cpu问题的方式"></a>排查cpu问题的方式</h4><p>我在大促压测中实践的比较多的方式是perf + perf-map-agent + FlamaGraph工具组合，其中perf是用来监控各个函数的cpu消耗(可以实时监控，也可以记录一段时间的数据)，perf-map-agent是用来辅助perf使用的，用来生成java堆的映射文件，FlamaGraph则是用来生成火焰图的。</p>
<p>这套工具的安装使用就不做介绍了，可以参考一下下面这两篇文章，</p>
<p><a href="http://senlinzhan.github.io/2018/03/18/perf/" target="_blank" rel="noopener">http://senlinzhan.github.io/2018/03/18/perf/</a><br><a href="https://www.jianshu.com/p/bea2b6a1eb6e" target="_blank" rel="noopener">https://www.jianshu.com/p/bea2b6a1eb6e</a> </p>
<p>主要使用方式，有如下两种:</p>
<ol>
<li>sudo perf top [-g]，可以实时观察cpu的消耗，操作相对比较轻量级</li>
<li>生成火焰图(一定要用浏览器打开)，操作相当繁琐，不过生成的信息也更详细，更易阅读，对于那些无法一眼看出来的问题会有不错的效果</li>
</ol>
<p><strong>火焰图示例</strong></p>
<p>下面展示一下本次大促压测solr优化过程中生成的火焰图，从图中可以看到YoungGC就占用了将近一半的cpu，</p>
<p><img alt="image-20191106155941396" data-src="https://img.cayun.me/2019-11-06-075942.png" class="lazyload"></p>
<p><strong>perf-top示例</strong></p>
<p>用这个示例代码做个perf-top的使用示范:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Date;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cpu</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> LIMIT = <span class="number">100000000</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">        simple();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">simple</span><span class="params">()</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">int</span> count = <span class="number">0</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">long</span> startTime = System.currentTimeMillis();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">while</span> (count &lt; LIMIT) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">            Date date = <span class="keyword">new</span> Date();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">            SimpleDateFormat df = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:ss SSS"</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">            String sd = df.format(date);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">            <span class="keyword">if</span> (sd.length() == <span class="number">23</span>) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">                count++;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line">            &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">        System.out.println(System.currentTimeMillis() - startTime);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>首先使用<code>perf-map-agent/bin/create-java-perf-map.sh [PID]</code>生成JVM映射文件，然后使用<code>sudo perf top</code>可以看到cpu基本上都被SimpleDateFormat给占用了，(下面还有很多展示不出来的，事实上会更多)</p>
<p><img alt="image-20191107113205727" data-src="https://img.cayun.me/2019-11-07-033206.png" class="lazyload"></p>
<p>有了这些工具之后，绝大多数问题都已经可以比较容易地找到性能优化点了。</p>
<h5 id="其他一些方式"><a href="#其他一些方式" class="headerlink" title="其他一些方式"></a>其他一些方式</h5><p>上面那套组合实际用起来十分繁琐，大促压测结束后又了解到了一些其他工具，不过未经过真实实践，所以列出来仅做参考:</p>
<ol>
<li><p>visualvm中的Sampler</p>
</li>
<li><p>jvmtop</p>
</li>
<li><p><a href="https://github.com/oldratlee/useful-scripts" target="_blank" rel="noopener">https://github.com/oldratlee/useful-scripts</a> ，这个里面有个show-busy-java-threads脚本，试用了一下，感觉超方便，后续考虑在真实排查问题中实践一下</p>
</li>
</ol>
<h3 id="7-线程阻塞问题"><a href="#7-线程阻塞问题" class="headerlink" title="7. 线程阻塞问题"></a>7. 线程阻塞问题</h3><p>当我们在系统的所有环节都无法找到硬件瓶颈的时候，那往往就是线程产生了阻塞，一般情况下线程阻塞可以使用jstack和arthas来排查，分别举个例子吧，用下面这段样例代码:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">30</span>; i++) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">                <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">                    run();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">                &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">9</span></pre></td><td class="code"><pre><span class="line">            &#125;, <span class="string">"myThread-"</span> + i);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">10</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">11</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">12</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">13</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">14</span></pre></td><td class="code"><pre><span class="line">        Integer x = <span class="number">1</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">15</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100000</span>; i++) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">16</span></pre></td><td class="code"><pre><span class="line">            x *= i;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">17</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">18</span></pre></td><td class="code"><pre><span class="line">        System.out.println(x);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">19</span></pre></td><td class="code"><pre><span class="line">        sleep(<span class="number">10</span>);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">20</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">21</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">22</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">sleep</span><span class="params">(<span class="keyword">long</span> millis)</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">23</span></pre></td><td class="code"><pre><span class="line">        <span class="keyword">try</span> &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">24</span></pre></td><td class="code"><pre><span class="line">            Thread.sleep(millis);</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">25</span></pre></td><td class="code"><pre><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">26</span></pre></td><td class="code"><pre><span class="line">            e.printStackTrace();</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">27</span></pre></td><td class="code"><pre><span class="line">        &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">28</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">29</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<h4 id="jstack的方式查看"><a href="#jstack的方式查看" class="headerlink" title="jstack的方式查看"></a>jstack的方式查看</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line">jstack [PID]</span></pre></td></tr></table></figure>

<p><img alt="image-20191106184616989" data-src="https://img.cayun.me/2019-11-06-104617.png" class="lazyload"></p>
<p>从图中可以看到大量的线程都卡在<code>Block.sleep()</code>上。一般情况下，jstack可以配合grep来使用，通常关注得比较多的状态更多是BLOCKED。jstack相对而言没那么直观，但是比较轻量级，很多时候也可以比较容易地看出来一些常见的线程阻塞问题。</p>
<h4 id="arthas的方式查看"><a href="#arthas的方式查看" class="headerlink" title="arthas的方式查看"></a>arthas的方式查看</h4><p>arthas其实是一个比较全能的jvm性能分析工具，用起来也是各种舒服，而且相对而言也比较轻量，强烈推荐。</p>
<p>此处主要介绍arthas在排查线程阻塞方面的应用，</p>
<ol>
<li>执行arthas，命令<code>java -jar arthas-boot.jar</code></li>
<li>选择目标java进程</li>
<li>执行<code>trace [包名.类名] [方法名] -n [数量] &#39;#cost&gt;[执行时间]&#39;</code>就可以查看了，更多参数可以查询arthas的文档</li>
</ol>
<p><img alt="image-20191106185440691" data-src="https://img.cayun.me/2019-11-06-105440.png" class="lazyload"></p>
<p>如上图，我们可以看到各个方法的执行时间（包含了阻塞时间），筛选出执行时间长的方法，很大可能就能发现造成线程阻塞的瓶颈点。</p>
<h3 id="8-内存泄漏问题"><a href="#8-内存泄漏问题" class="headerlink" title="8. 内存泄漏问题"></a>8. 内存泄漏问题</h3><p>内存泄漏问题往往都伴随着宕机，我所遇见的情况有如下几种:</p>
<h4 id="Heap内存泄漏"><a href="#Heap内存泄漏" class="headerlink" title="Heap内存泄漏"></a>Heap内存泄漏</h4><p>这种情况属于相对而言比较容易处理的情况，使用-XX:+HeapDumpOnOutOfMemoryError参数可以在应用宕机的时候自动dump下堆文件，然后使用MAT等内存分析工具在绝大多数情况下都可以找到问题原因。</p>
<h4 id="metaspace内存泄漏"><a href="#metaspace内存泄漏" class="headerlink" title="metaspace内存泄漏"></a>metaspace内存泄漏</h4><p>这个有见过JVM调用groovy在某些情况下会产生内存泄漏。不过没有真实排查过相关问题，此处略过。</p>
<p>防风有一篇文章可以参考一下<a href="https://ffutop.github.io/posts/2019-11-07-groovyclassloader-fullgc/" target="_blank" rel="noopener">GroovyClassLoader 引发的 FullGC</a></p>
<h4 id="nonheap内存泄漏"><a href="#nonheap内存泄漏" class="headerlink" title="nonheap内存泄漏"></a>nonheap内存泄漏</h4><p>nonheap内存泄漏问题属于非常难排查的问题，一般情况下比较难dump下堆文件，即使dump下来了，一般情况下也很难确定原因，之前有用过tcmalloc、jemalloc等工具进行排查过。暂时没找到什么比较通用的套路，一般也是特事特办。根据之前的排查经验来看，如下几种情况会比较容易出现nonheap内存泄漏（如果遗漏，请留言补充）:</p>
<ol>
<li>图片合成业务中，涉及到Font的创建，可以详见之前的文章<a href="https://www.cayun.me/java/%E8%AE%B0%E4%B8%80%E6%AC%A1Font%E5%AF%BC%E8%87%B4JVM%E5%A0%86%E5%A4%96%E5%86%85%E5%AD%98%E6%B3%84%E6%BC%8F%E5%88%86%E6%9E%90/">记一次Font导致JVM堆外内存泄漏分析</a></li>
<li>使用了JNI的情况下很有可能会导致JVM的arena内存区刚好超过机器内存限制 / nonheap内存泄漏（可以参考防风的文章<a href="https://ffutop.github.io/posts/2019-07-06-jni_problem/" target="_blank" rel="noopener">JNI 引发的堆外内存泄露</a>）</li>
<li>GZIPStream未关闭的情况会导致nonheap泄漏 (来源于网上资料，未真实遇到过)</li>
</ol>
<h3 id="9-从业务角度去排查问题"><a href="#9-从业务角度去排查问题" class="headerlink" title="9. 从业务角度去排查问题"></a>9. 从业务角度去排查问题</h3><p>排查很多问题之前，最好能够先去了解一下相关业务逻辑，因为很多性能问题是由于大量的问题业务代码引起的，很多时候从业务角度去考虑、辅以技术手段往往能够得到更好的效果。</p>
<h3 id="10-总结"><a href="#10-总结" class="headerlink" title="10. 总结"></a>10. 总结</h3><p>上面的各种方式只是提供一些策略，无法保证100%能够找到问题，甚至可能连70%都保证不了，更多情况下我们需要灵活使用各种工具进行问题分析。总结一下上面的性能分析工具，可以大概如下分类:</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>工具</th>
</tr>
</thead>
<tbody><tr>
<td>全能型分析工具</td>
<td>arthas、visualvm</td>
</tr>
<tr>
<td>cpu分析工具</td>
<td>perf、jvmtop</td>
</tr>
<tr>
<td>内存分析工具</td>
<td>jmap、jhat、MAT</td>
</tr>
<tr>
<td>网络分析工具</td>
<td>tcpdump、wireshark</td>
</tr>
<tr>
<td>GC分析工具</td>
<td>jstat、gc日志文件、visualvm</td>
</tr>
<tr>
<td>堆栈分析工具</td>
<td>jstack、arthas</td>
</tr>
<tr>
<td>Linux底层排查工具</td>
<td>strace、perf、dmesg、journalctl</td>
</tr>
</tbody></table>
<p>有些工具甚至有更多的功能，例如arthas和visualvm，可能会漏掉一些分类，每种分类也同样还有着各种各样其他的分析工具，此处就不求尽善尽美了。</p>
<h1 id="六、压测中出现的典型性能问题"><a href="#六、压测中出现的典型性能问题" class="headerlink" title="六、压测中出现的典型性能问题"></a>六、压测中出现的典型性能问题</h1><p>以下总结一下我在大促压测过程中所遇到的一些比较典型的性能问题。</p>
<h3 id="1-Log4j日志阻塞问题"><a href="#1-Log4j日志阻塞问题" class="headerlink" title="1. Log4j日志阻塞问题"></a>1. Log4j日志阻塞问题</h3><p>公司的部分老应用仍然使用的Log4j，打印日志全部为同步方式，就会导致在并发高且业务日志多的情况下，会造成日志大量阻塞。</p>
<h3 id="2-redis大value问题"><a href="#2-redis大value问题" class="headerlink" title="2. redis大value问题"></a>2. redis大value问题</h3><p>有些代码不论有多大的数据都直接往redis里面塞，只要并发稍微一高，就很容易导致redis的带宽达到上限。</p>
<h3 id="3-sql全字段查询问题"><a href="#3-sql全字段查询问题" class="headerlink" title="3. sql全字段查询问题"></a>3. sql全字段查询问题</h3><p>很多代码查询mysql的时候，无论什么场景都会将表的所有的字段都查询出来，会导致两个结果:</p>
<ol>
<li>网络带宽极大浪费，尤其是查询中包含了不必要的”描述”等超大字段</li>
<li>极大地消耗cpu资源</li>
</ol>
<h3 id="4-sql未加索引问题"><a href="#4-sql未加索引问题" class="headerlink" title="4. sql未加索引问题"></a>4. sql未加索引问题</h3><p>比较容易犯的问题，一般会产生慢SQL，甚至可能导致数据库cpu消耗严重。</p>
<h3 id="5-sql-N-1问题"><a href="#5-sql-N-1问题" class="headerlink" title="5. sql N+1问题"></a>5. sql N+1问题</h3><p>也是比较容器犯的问题，会对应用本身和数据库都产生或多或少的性能影响，至于具体的影响度暂时还没有直观数据。</p>
<h3 id="6-正则表达式问题"><a href="#6-正则表达式问题" class="headerlink" title="6. 正则表达式问题"></a>6. 正则表达式问题</h3><p>正则表达式在业务中也是比较常用的，但是有些糟糕的正则表达式可能会导致一些可怕的后果，会严重消耗cpu资源，举个例子，如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Regex</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">2</span></pre></td><td class="code"><pre><span class="line"></span></pre></td></tr><tr><td class="gutter"><pre><span class="line">3</span></pre></td><td class="code"><pre><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">4</span></pre></td><td class="code"><pre><span class="line">        String regex = <span class="string">"(\\w+,?)+"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">5</span></pre></td><td class="code"><pre><span class="line">        String val = <span class="string">"abcdefghijklmno,abcdefghijklmno+"</span>;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">6</span></pre></td><td class="code"><pre><span class="line">        System.out.println(val.matches(regex));</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">7</span></pre></td><td class="code"><pre><span class="line">    &#125;</span></pre></td></tr><tr><td class="gutter"><pre><span class="line">8</span></pre></td><td class="code"><pre><span class="line">&#125;</span></pre></td></tr></table></figure>

<p>就这么一段看上去简单的代码，会一直保持着cpu单核100%的状态，而且会执行15秒左右。具体原因可以详见防风的文章 <a href="https://www.ffutop.com/posts/2018-11-16-regex-exponential-explosion/" target="_blank" rel="noopener">https://www.ffutop.com/posts/2018-11-16-regex-exponential-explosion/</a></p>
<h3 id="7-DateFormat问题"><a href="#7-DateFormat问题" class="headerlink" title="7. DateFormat问题"></a>7. DateFormat问题</h3><p>大量使用DateFormat导致极大地cpu资源消耗，一般情况下请使用FastDateFormat替代SimpleDateFormat，性能能提升一倍以上。对于一些时间点比较规整的且瓶颈点仍在DateFormat上的，可以考虑使用缓存等方案。</p>
<h3 id="8-线程池不正确使用问题"><a href="#8-线程池不正确使用问题" class="headerlink" title="8. 线程池不正确使用问题"></a>8. 线程池不正确使用问题</h3><p>远程调用时长远大于cpu消耗的业务直接使用默认线程池或着线程数设置太少，很容易导致线程阻塞。</p>
<h3 id="9-传说中的问题"><a href="#9-传说中的问题" class="headerlink" title="9. 传说中的问题"></a>9. 传说中的问题</h3><p>只听说过，但是我还从未真实见到过，</p>
<ol>
<li>大量线程切换导致cpu开销大</li>
<li>数据库死锁问题</li>
<li>数据库连接池设置问题（有发生过几次，但是我都不在现场）</li>
<li>… …</li>
</ol>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined" target="_blank" rel="noopener">木枣粽子</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="/https:/www.cayun.me/java/%E5%8F%8C%E5%8D%81%E4%B8%80%E5%8E%8B%E6%B5%8B&amp;Java%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%80%BB%E7%BB%93/">https://www.cayun.me/java/%E5%8F%8C%E5%8D%81%E4%B8%80%E5%8E%8B%E6%B5%8B&amp;Java%E5%BA%94%E7%94%A8%E6%80%A7%E8%83%BD%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5%E6%80%BB%E7%BB%93/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://www.cayun.me">木枣粽子 | BLOG</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java    </a><a class="post-meta__tags" href="/tags/%E6%80%A7%E8%83%BD/">性能    </a></div><div class="post_share"></div></div></div></div><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2018 - 2019 By 木枣粽子</div><div class="framework-info"><span>驱动 </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>主题 </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="阅读模式"></i><i class="fa fa-plus" id="font_plus" title="放大字体"></i><i class="fa fa-minus" id="font_minus" title="缩小字体"></i><i class="darkmode fa fa-moon-o" id="darkmode" title="夜间模式"></i></div><div id="rightside-config-show"><div id="rightside_config" title="设置"><i class="fa fa-cog" aria-hidden="true"></i></div><i class="fa fa-list-ul close" id="mobile-toc-button" title="目录" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="回到顶部" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.jsdelivr.net/npm/mathjax/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script src="/js/baidupush.js"> </script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>